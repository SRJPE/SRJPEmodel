<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passage to Spawner Submodel • SRJPEmodel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Passage to Spawner Submodel">
<meta property="og:description" content="SRJPEmodel">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SRJPEmodel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/passage_to_spawner_submodel.html">Passage to Spawner Model (P2S)</a>
    </li>
    <li>
      <a href="../articles/btspas_submodel_documentation.html">Juvenile Abundance Model (BTSPAS-X)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SRJPE/SRJPEmodel" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Passage to Spawner Submodel</h1>
                        <h4 data-toc-skip class="author">Liz Stebbins,
Ashley Vizek, Erin Cain, Josh Korman</h4>
            
      
      
      <div class="hidden name"><code>passage_to_spawner_submodel.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The Passage to Spawner (P2S) is a Bayesian model that produces
estimates of spawning adults for <code>Battle Creek</code>,
<code>Clear Creek</code>, <code>Deer Creek</code>, and
<code>Mill Creek</code> with uncertainty. The model can be used to get
spawning adults for a tributary as part of any stock-recruit-based SRJPE
model alternative.</p>
</div>
<div class="section level3">
<h3 id="submodel-objective">Submodel Objective<a class="anchor" aria-label="anchor" href="#submodel-objective"></a>
</h3>
<p>The purpose of the P2S submodel is to take in observed upstream
passage, or escapement, estimates from a tributary and model the
relationship with spawner counts, either from redd surveys or holding
surveys. The P2S produces estimated spawner counts with uncertainty for
use in creating the <code>stock</code> portion of a
<code>stock-recruit model</code> in the SRJPE.</p>
<p>The model also estimates a <code>conversion rate</code>, or
proportion of adults that pass though the video counting systems that
become spawning adults (i.e. prespawn mortality). The P2S can also be
used for forecasting; it takes in a standardized environmental covariate
and uses this variable to predict spawners from upstream passage counts.
In this way, the P2S provides resiliency for years where data may be
missing (i.e. years where upstream passage data were collected but
spawner surveys were not conducted).</p>
</div>
<div class="section level3">
<h3 id="conceptual-model">Conceptual model<a class="anchor" aria-label="anchor" href="#conceptual-model"></a>
</h3>
<p>This is a DRAFT conceptual model detailing where submodels fit into
the overall SRJPE model ecosystem.</p>
<p><img src="images/SRJPE%20Conceptual%20Model%20-%202-15-2024.png" width="500px"></p>
</div>
<div class="section level3">
<h3 id="submodel-architecture">Submodel Architecture<a class="anchor" aria-label="anchor" href="#submodel-architecture"></a>
</h3>
<p>The submodel takes observed data (in orange) and predicts spawner
counts (in pink). Parameters estimated by the model are light pink; for
more information, see documentation.</p>
<p><img src="images/parameter_diagram.png" width="500px"></p>
</div>
<div class="section level2">
<h2 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h2>
<p>The model takes in two datasets:</p>
<ul>
<li>
<strong>Observed adult counts</strong> or estimates from all methods
(upstream passage, holding surveys, redd surveys, and carcass surveys)
aggregated by year and stream. This is in the
<code><a href="https://rdrr.io/pkg/SRJPEdata/man/observed_adult_input.html" class="external-link">SRJPEdata::observed_adult_input</a></code> data object.</li>
<li>
<strong>Observed environmental covariates</strong> aggregated by
year within streams, and standardized (scaled to center on 0). This is
in the <code>SRJPEdata::adult_model_covariates_standard</code>
object.</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-the-p2s-submodel">Running the P2S submodel<a class="anchor" aria-label="anchor" href="#running-the-p2s-submodel"></a>
</h2>
<p>The model is run for a given stream and environmental covariate.</p>
<ul>
<li>Options for streams are <code>battle creek</code>,
<code>clear creek</code>, <code>deer creek</code>, and
<code>mill creek</code>.</li>
<li>Environmental covariates are <code>water year type</code>,
<code>growing degree days</code>, and <code>maximum flow</code>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the model for battle creek and water year type</span></span>
<span><span class="va">battle_P2S_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_passage_to_spawner_model.html">run_passage_to_spawner_model</a></span><span class="op">(</span><span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/SRJPEdata/man/observed_adult_input.html" class="external-link">observed_adult_input</a></span>,</span>
<span>                                                   <span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va">adult_model_covariates_standard</span>,</span>
<span>                                                   <span class="st">"battle creek"</span>,</span>
<span>                                                   <span class="st">"wy_type"</span>,</span>
<span>                                                   <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run the model for clear creek and water year type</span></span>
<span><span class="va">clear_P2S_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_passage_to_spawner_model.html">run_passage_to_spawner_model</a></span><span class="op">(</span><span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/SRJPEdata/man/observed_adult_input.html" class="external-link">observed_adult_input</a></span>,</span>
<span>                                                  <span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va">adult_model_covariates_standard</span>,</span>
<span>                                                  <span class="st">"clear creek"</span>,</span>
<span>                                                  <span class="st">"wy_type"</span>,</span>
<span>                                                  <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run the model for deer creek and water year type</span></span>
<span><span class="va">deer_P2S_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_passage_to_spawner_model.html">run_passage_to_spawner_model</a></span><span class="op">(</span><span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/SRJPEdata/man/observed_adult_input.html" class="external-link">observed_adult_input</a></span>,</span>
<span>                                                 <span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va">adult_model_covariates_standard</span>,</span>
<span>                                                 <span class="st">"deer creek"</span>,</span>
<span>                                                 <span class="st">"wy_type"</span>,</span>
<span>                                                 <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># run the model for mill creek and water year type</span></span>
<span><span class="va">mill_P2S_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_passage_to_spawner_model.html">run_passage_to_spawner_model</a></span><span class="op">(</span><span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/SRJPEdata/man/observed_adult_input.html" class="external-link">observed_adult_input</a></span>,</span>
<span>                                                 <span class="fu">SRJPEdata</span><span class="fu">::</span><span class="va">adult_model_covariates_standard</span>,</span>
<span>                                                 <span class="st">"mill creek"</span>,</span>
<span>                                                 <span class="st">"wy_type"</span>,</span>
<span>                                                 <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Once the model has been fit to separate streams, you can combine them
into one data frame:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># join model summaries</span></span>
<span><span class="va">P2S_model_fits</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">battle_P2S_results</span><span class="op">$</span><span class="va">formatted_pars</span>,</span>
<span>                            <span class="va">clear_P2S_results</span><span class="op">$</span><span class="va">formatted_pars</span>,</span>
<span>                            <span class="va">mill_P2S_results</span><span class="op">$</span><span class="va">formatted_pars</span>,</span>
<span>                            <span class="va">deer_P2S_results</span><span class="op">$</span><span class="va">formatted_pars</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-output">Model Output<a class="anchor" aria-label="anchor" href="#model-output"></a>
</h2>
<p>The P2S model produces two objects when run:</p>
<ul>
<li>a <code>full_object</code>, which contains all output of the STAN
model (class <code>stanfit</code>)</li>
<li>
<code>formatted_pars</code>, a data table with all parameter
estimates and associated statistics.</li>
</ul>
<p>The most recent results from fitting the model to all streams is
stored as a data object <code><a href="../reference/P2S_model_fits.html">SRJPEmodel::P2S_model_fits</a></code> and
contains the full parameter list, many of which are technical and not
directly of interest to the <code>SRJPEmodel</code> ecosystem.
<code>SRJPEmodel</code> has additional functions to extract parameter
estimates of interest from this larger table and can quickly produce a
table of predicted spawners by year and tributary.</p>
<div class="section level3">
<h3 id="extract-predicted-spawners-by-year-with-uncertainty">Extract predicted spawners by year, with uncertainty<a class="anchor" aria-label="anchor" href="#extract-predicted-spawners-by-year-with-uncertainty"></a>
</h3>
<table class="table">
<colgroup>
<col width="14%">
<col width="5%">
<col width="29%">
<col width="11%">
<col width="11%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="left">stream</th>
<th align="right">year</th>
<th align="right">median_predicted_spawners</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
<th align="left">data_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">battle creek</td>
<td align="right">2001</td>
<td align="right">30.72404</td>
<td align="right">21.78930</td>
<td align="right">41.77793</td>
<td align="left">P2S_predicted_spawners</td>
</tr>
<tr class="even">
<td align="left">battle creek</td>
<td align="right">2002</td>
<td align="right">70.62890</td>
<td align="right">56.14741</td>
<td align="right">87.68848</td>
<td align="left">P2S_predicted_spawners</td>
</tr>
<tr class="odd">
<td align="left">battle creek</td>
<td align="right">2003</td>
<td align="right">152.91438</td>
<td align="right">130.77486</td>
<td align="right">178.05002</td>
<td align="left">P2S_predicted_spawners</td>
</tr>
<tr class="even">
<td align="left">battle creek</td>
<td align="right">2004</td>
<td align="right">33.45492</td>
<td align="right">24.34624</td>
<td align="right">45.02828</td>
<td align="left">P2S_predicted_spawners</td>
</tr>
<tr class="odd">
<td align="left">battle creek</td>
<td align="right">2005</td>
<td align="right">44.07281</td>
<td align="right">33.02084</td>
<td align="right">57.61342</td>
<td align="left">P2S_predicted_spawners</td>
</tr>
</tbody>
</table>
<p><img src="passage_to_spawner_submodel_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>We can also see forecasted spawner count for a wet or dry year with
uncertainty by looking at the <code>abundance_forecast</code>
parameters, which use the average upstream passage as a predictor
variable and water year type as the predictive covariate. Deer and Mill
Creek model fits are limited in utility due to a lack of available data,
so the confidence intervals for those tributaries are much greater than
for Battle and Clear Creeks.</p>
<p><img src="passage_to_spawner_submodel_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<p>See
<code>data-raw/adult_model/passage_to_spawner_full_docmentation.Rmd</code>
for full documentation of development, testing, and results of the
Passage to Spawner submodel. See <code>adult data report</code> for full
documentation on adult Chinook salmon data collection.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ashley Vizek, Erin Cain, Liz Stebbins.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
