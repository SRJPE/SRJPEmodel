<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passage to Spawner Submodel • SRJPEmodel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Passage to Spawner Submodel">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SRJPEmodel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/passage_to_spawner_submodel.html">Passage to Spawner Model (P2S)</a>
    </li>
    <li>
      <a href="../articles/btspas_submodel_documentation.html">Juvenile Abundance Model (BTSPAS-X)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SRJPE/SRJPEmodel" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Passage to Spawner Submodel</h1>
                        <h4 data-toc-skip class="author">Liz Stebbins,
Ashley Vizek, Erin Cain, Josh Korman</h4>
            
      

      <div class="hidden name"><code>passage_to_spawner_submodel.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The Passage to Spawner (P2S) is a Bayesian model that produces
estimates of spawning adults for <code>Battle Creek</code>,
<code>Clear Creek</code>, <code>Deer Creek</code>, and
<code>Mill Creek</code> with uncertainty. The model can be used to get
spawning adults for a tributary as part of any stock-recruit-based SRJPE
model alternative.</p>
</div>
<div class="section level3">
<h3 id="submodel-objective">Submodel Objective<a class="anchor" aria-label="anchor" href="#submodel-objective"></a>
</h3>
<p>The purpose of the P2S submodel is to take in observed upstream
passage, or escapement, estimates from a tributary and model the
relationship with spawner counts, either from redd surveys or holding
surveys. The P2S produces estimated spawner counts with uncertainty for
use in creating the <code>stock</code> portion of a
<code>stock-recruit model</code> in the SRJPE.</p>
<p>The model also estimates a <code>conversion rate</code>, or
proportion of adults that pass though the video counting systems that
become spawning adults (i.e. prespawn mortality). The P2S can also be
used for forecasting; it takes in a standardized environmental covariate
and uses this variable to predict spawners from upstream passage counts.
In this way, the P2S provides resiliency for years where data may be
missing (i.e. years where upstream passage data were collected but
spawner surveys were not conducted).</p>
</div>
<div class="section level3">
<h3 id="conceptual-model">Conceptual model<a class="anchor" aria-label="anchor" href="#conceptual-model"></a>
</h3>
<p>P2S estimates adult abundance needed for the stock recruit model. See
figure 1 below to see how it fits into the full JPE model system.</p>
<p>Figure 1: Conceptual Diagram of SRJPE model. P2S sub-model
highlighted in yellow
<img src="images%2FP2S%20jpe%20diagram.png" width="500px"></p>
</div>
<div class="section level3">
<h3 id="submodel-architecture">Submodel Architecture<a class="anchor" aria-label="anchor" href="#submodel-architecture"></a>
</h3>
<p>The submodel takes observed data (in orange) and predicts spawner
counts (in pink). Parameters estimated by the model are light pink; for
more information, see documentation.</p>
<p><img src="images%2FP2S_for_dashboard.png" width="500px"></p>
</div>
<div class="section level2">
<h2 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h2>
<p>The model takes in two datasets:</p>
<ul>
<li>
<strong>Observed adult counts</strong> or estimates from all methods
(upstream passage, holding surveys, redd surveys, and carcass surveys)
aggregated by year and stream. This is in the
<code><a href="https://rdrr.io/pkg/SRJPEdata/man/observed_adult_input.html" class="external-link">SRJPEdata::observed_adult_input</a></code> data object.</li>
<li>
<strong>Observed environmental covariates</strong> aggregated by
year within streams, and standardized (scaled to center on 0). This is
in the <code>SRJPEdata::adult_model_covariates_standard</code>
object.</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-the-p2s-submodel">Running the P2S submodel<a class="anchor" aria-label="anchor" href="#running-the-p2s-submodel"></a>
</h2>
<div class="section level3">
<h3 id="for-a-given-stream-and-covariate">For a given stream and covariate<a class="anchor" aria-label="anchor" href="#for-a-given-stream-and-covariate"></a>
</h3>
<p>The model is run for a given stream and environmental covariate.</p>
<ul>
<li>Options for streams are <code>battle creek</code> and
<code>clear creek</code>.</li>
<li>Environmental covariates are <code>water year type</code>,
<code>growing degree days</code>, <code>maximum flow</code>,
<code>median passage timing</code>, and <code>passage index</code>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the model for battle creek and water year type</span></span>
<span><span class="va">battle_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_P2S_inputs.html">prepare_P2S_inputs</a></span><span class="op">(</span><span class="st">"battle creek"</span>, <span class="st">"wy_type"</span><span class="op">)</span></span>
<span><span class="va">battle_P2S_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_passage_to_spawner_model.html">run_passage_to_spawner_model</a></span><span class="op">(</span><span class="va">battle_inputs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="for-all-covariates-within-a-stream">For all covariates within a stream<a class="anchor" aria-label="anchor" href="#for-all-covariates-within-a-stream"></a>
</h3>
<p>This truncates the dataset to only those years where all covariate
data is available. You can look at parameters that help diagnose the
performance of the different covariates like <code>R2_data</code>,
<code>R2_fixed</code>, <code>mean_redds_per_spawner</code>, and
<code>b1_survival</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the model for battle creek and water year type</span></span>
<span><span class="va">battle_covariate_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_P2S_model_covariates.html">compare_P2S_model_covariates</a></span><span class="op">(</span><span class="st">"battle creek"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">battle_covariate_comparison</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R2_data"</span>, <span class="st">"R2_fixed"</span>, <span class="st">"mean_redds_per_spawner"</span>,</span>
<span>                          <span class="st">"sigma_redds_per_spawner"</span>, <span class="st">"b1_survival"</span>,</span>
<span>                          <span class="st">"spawner_abundance_forecast"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-output">Model Output<a class="anchor" aria-label="anchor" href="#model-output"></a>
</h2>
<p>The P2S model produces a STANfit object when run. You can extract
parameter estimates from the model object with the function
<code><a href="../reference/extract_P2S_estimates.html">extract_P2S_estimates()</a></code>. This produces a table.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">battle_parameter_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_P2S_estimates.html">extract_P2S_estimates</a></span><span class="op">(</span><span class="va">battle_P2S_model</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">battle_parameter_estimates</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="19%">
<col width="8%">
<col width="7%">
<col width="7%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="6%">
<col width="7%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">parameter</th>
<th align="right">mean</th>
<th align="right">se_mean</th>
<th align="right">sd</th>
<th align="right">2.5</th>
<th align="right">25</th>
<th align="right">50</th>
<th align="right">75</th>
<th align="right">97.5</th>
<th align="right">n_eff</th>
<th align="right">Rhat</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">log_mean_redds_per_spawner</td>
<td align="right">-0.7756127</td>
<td align="right">0.0009767</td>
<td align="right">0.1662082</td>
<td align="right">-1.1088123</td>
<td align="right">-0.8826713</td>
<td align="right">-0.7743096</td>
<td align="right">-0.6676304</td>
<td align="right">-0.4474190</td>
<td align="right">28957.38</td>
<td align="right">1.0001819</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">sigma_redds_per_spawner</td>
<td align="right">0.6176322</td>
<td align="right">0.0005426</td>
<td align="right">0.1185665</td>
<td align="right">0.4352698</td>
<td align="right">0.5341672</td>
<td align="right">0.6007244</td>
<td align="right">0.6824753</td>
<td align="right">0.8992626</td>
<td align="right">47743.00</td>
<td align="right">1.0001319</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">b_survival</td>
<td align="right">0.2207787</td>
<td align="right">0.0029467</td>
<td align="right">0.3314244</td>
<td align="right">-0.4351591</td>
<td align="right">0.0046350</td>
<td align="right">0.2197987</td>
<td align="right">0.4356461</td>
<td align="right">0.8865241</td>
<td align="right">12650.26</td>
<td align="right">1.0004669</td>
<td align="right">2001</td>
</tr>
<tr class="even">
<td align="left">log_redds_per_spawner</td>
<td align="right">-1.2754301</td>
<td align="right">0.0005788</td>
<td align="right">0.1728325</td>
<td align="right">-1.6260166</td>
<td align="right">-1.3910668</td>
<td align="right">-1.2711890</td>
<td align="right">-1.1559771</td>
<td align="right">-0.9504445</td>
<td align="right">89168.74</td>
<td align="right">1.0000197</td>
<td align="right">2001</td>
</tr>
<tr class="odd">
<td align="left">log_redds_per_spawner</td>
<td align="right">-1.1327236</td>
<td align="right">0.0003877</td>
<td align="right">0.1164060</td>
<td align="right">-1.3684956</td>
<td align="right">-1.2099801</td>
<td align="right">-1.1305666</td>
<td align="right">-1.0535601</td>
<td align="right">-0.9122176</td>
<td align="right">90168.53</td>
<td align="right">0.9999576</td>
<td align="right">2002</td>
</tr>
<tr class="even">
<td align="left">log_redds_per_spawner</td>
<td align="right">-0.5759191</td>
<td align="right">0.0029505</td>
<td align="right">0.3364033</td>
<td align="right">-1.2524814</td>
<td align="right">-0.7937494</td>
<td align="right">-0.5754964</td>
<td align="right">-0.3554868</td>
<td align="right">0.0866867</td>
<td align="right">12999.47</td>
<td align="right">1.0004778</td>
<td align="right">2003</td>
</tr>
<tr class="odd">
<td align="left">log_redds_per_spawner</td>
<td align="right">-0.9447890</td>
<td align="right">0.0005517</td>
<td align="right">0.1621853</td>
<td align="right">-1.2723532</td>
<td align="right">-1.0527563</td>
<td align="right">-0.9414259</td>
<td align="right">-0.8333916</td>
<td align="right">-0.6380928</td>
<td align="right">86427.66</td>
<td align="right">0.9999703</td>
<td align="right">2004</td>
</tr>
<tr class="even">
<td align="left">log_redds_per_spawner</td>
<td align="right">-0.6980111</td>
<td align="right">0.0029671</td>
<td align="right">0.3493897</td>
<td align="right">-1.3982250</td>
<td align="right">-0.9257723</td>
<td align="right">-0.6980626</td>
<td align="right">-0.4669272</td>
<td align="right">-0.0134806</td>
<td align="right">13866.49</td>
<td align="right">1.0004266</td>
<td align="right">2005</td>
</tr>
<tr class="odd">
<td align="left">log_redds_per_spawner</td>
<td align="right">-0.8264333</td>
<td align="right">0.0029588</td>
<td align="right">0.3382511</td>
<td align="right">-1.5006455</td>
<td align="right">-1.0461285</td>
<td align="right">-0.8252512</td>
<td align="right">-0.6038720</td>
<td align="right">-0.1573202</td>
<td align="right">13068.74</td>
<td align="right">1.0004673</td>
<td align="right">2006</td>
</tr>
<tr class="even">
<td align="left">log_redds_per_spawner</td>
<td align="right">-0.7938967</td>
<td align="right">0.0002782</td>
<td align="right">0.0860919</td>
<td align="right">-0.9653668</td>
<td align="right">-0.8509358</td>
<td align="right">-0.7926342</td>
<td align="right">-0.7352431</td>
<td align="right">-0.6292074</td>
<td align="right">95740.56</td>
<td align="right">0.9999721</td>
<td align="right">2007</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="extract-predicted-spawners-by-year-with-uncertainty">Extract predicted spawners by year, with uncertainty<a class="anchor" aria-label="anchor" href="#extract-predicted-spawners-by-year-with-uncertainty"></a>
</h3>
<p><img src="passage_to_spawner_submodel_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>We can also see forecasted spawner count for a wet or dry year with
uncertainty by looking at the <code>abundance_forecast</code>
parameters, which use the average upstream passage as a predictor
variable and water year type as the predictive covariate. Deer and Mill
Creek model fits are limited in utility due to a lack of available data,
so the confidence intervals for those tributaries are much greater than
for Battle and Clear Creeks.</p>
<p><img src="passage_to_spawner_submodel_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<p>See the <a href="https://srjpe.s3.us-west-1.amazonaws.com/P2S_documentation_2025-01-28.pdf" class="external-link">Passage
to Spawner Full Model Description</a> for full documentation of
development, testing, and results of the submodel. Codebase for the
analysis in the Full Model Description can be found <a href="https://github.com/SRJPE/SRJPEmodel/tree/main/data-raw/adult_model" class="external-link">here</a>.
See <code>adult data report</code> for full documentation on adult
Chinook salmon data collection.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ashley Vizek, Erin Cain, Liz Stebbins.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
